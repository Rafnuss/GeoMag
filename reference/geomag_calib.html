<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calibrate Magnetic and Acceleration Data for 3-Axis Sensors — geomag_calib • GeoMag</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calibrate Magnetic and Acceleration Data for 3-Axis Sensors — geomag_calib"><meta name="description" content="Performs tilt compensation and magnetic calibration for 3-axis sensor data, with support for
in situ and in vitro calibration routines, outlier removal, and computation of orientation and
field parameters. This function is designed for use with GeoPressureR tag objects and can
utilize calibration datasets if available.
Workflow


Determine static/movement states:
Classify each data point as static or moving by evaluating acceleration signals.
Magnetic Data Calibration:
Select calibration data source (raw or from calibration dataset).
Optionally remove extreme or outlier values.
Fit and apply a calibration model (sphere/ellipse or their stap variants).

Tilt Compensation:
Compute pitch and roll from acceleration.
Project gravity and calibrated magnetic data into the horizontal plane of the Earth frame.

Orientation and Field Parameters:
Calculate heading, field intensity, and inclination.
Store calibration metadata and processed data in the tag object.




"><meta property="og:description" content="Performs tilt compensation and magnetic calibration for 3-axis sensor data, with support for
in situ and in vitro calibration routines, outlier removal, and computation of orientation and
field parameters. This function is designed for use with GeoPressureR tag objects and can
utilize calibration datasets if available.
Workflow


Determine static/movement states:
Classify each data point as static or moving by evaluating acceleration signals.
Magnetic Data Calibration:
Select calibration data source (raw or from calibration dataset).
Optionally remove extreme or outlier values.
Fit and apply a calibration model (sphere/ellipse or their stap variants).

Tilt Compensation:
Compute pitch and roll from acceleration.
Project gravity and calibrated magnetic data into the horizontal plane of the Earth frame.

Orientation and Field Parameters:
Calculate heading, field intensity, and inclination.
Store calibration metadata and processed data in the tag object.




"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GeoMag</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rafnuss/GeoMag/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calibrate Magnetic and Acceleration Data for 3-Axis Sensors</h1>
      <small class="dont-index">Source: <a href="https://github.com/Rafnuss/GeoMag/blob/master/R/geomag_calib.R" class="external-link"><code>R/geomag_calib.R</code></a></small>
      <div class="d-none name"><code>geomag_calib.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs tilt compensation and magnetic calibration for 3-axis sensor data, with support for
in situ and in vitro calibration routines, outlier removal, and computation of orientation and
field parameters. This function is designed for use with <code>GeoPressureR</code> tag objects and can
utilize calibration datasets if available.</p><div class="section">
<h3 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a></h3>

<ol><li><p><strong>Determine static/movement states:</strong>
Classify each data point as static or moving by evaluating acceleration signals.</p></li>
<li><p><strong>Magnetic Data Calibration:</strong></p><ul><li><p>Select calibration data source (raw or from calibration dataset).</p></li>
<li><p>Optionally remove extreme or outlier values.</p></li>
<li><p>Fit and apply a calibration model (sphere/ellipse or their stap variants).</p></li>
</ul></li>
<li><p><strong>Tilt Compensation:</strong></p><ul><li><p>Compute pitch and roll from acceleration.</p></li>
<li><p>Project gravity and calibrated magnetic data into the horizontal plane of the Earth frame.</p></li>
</ul></li>
<li><p><strong>Orientation and Field Parameters:</strong></p><ul><li><p>Calculate heading, field intensity, and inclination.</p></li>
<li><p>Store calibration metadata and processed data in the tag object.</p></li>
</ul></li>
</ol></div>

    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">geomag_calib</span><span class="op">(</span></span>
<span>  <span class="va">tag</span>,</span>
<span>  calib_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  calib_method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rm_outlier <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-tag">tag<a class="anchor" aria-label="anchor" href="#arg-tag"></a></dt>
<dd><p>A <code>GeoPressureR</code> tag object containing magnetic and acceleration data.</p></dd>


<dt id="arg-calib-data">calib_data<a class="anchor" aria-label="anchor" href="#arg-calib-data"></a></dt>
<dd><p>Logical, character, or <code>NULL</code>.
If <code>TRUE</code>, uses calibration data from <code>magCalib/</code> subfolder.
If <code>FALSE</code>, calibrates using in situ data.
If a character path, uses calibration data from the specified directory.
If <code>NULL</code>, auto-detects calibration folder.</p></dd>


<dt id="arg-calib-method">calib_method<a class="anchor" aria-label="anchor" href="#arg-calib-method"></a></dt>
<dd><p>Character. Calibration method, one of <code>"sphere"</code>, <code>"ellipse"</code>,
<code>"near-sphere"</code>, <code>"sphere_stap"</code>, or <code>"ellipse_stap"</code>. If <code>NULL</code>, chosen automatically.</p></dd>


<dt id="arg-rm-outlier">rm_outlier<a class="anchor" aria-label="anchor" href="#arg-rm-outlier"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, removes outliers from calibration data (recommended).</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, suppresses progress messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Modified <code>GeoPressureR</code> tag object. The <code>$magnetic</code> data frame contains:</p><ul><li><p><code>date</code>: Timestamp (POSIXct or numeric)</p></li>
<li><p><code>acceleration_x</code>, <code>acceleration_y</code>, <code>acceleration_z</code>: Raw acceleration data</p></li>
<li><p><code>magnetic_x</code>, <code>magnetic_y</code>, <code>magnetic_z</code>: Raw magnetic data</p></li>
<li><p><code>is_static</code>: Scaled MAD of acceleration (0 = static, &gt;1 = movement)</p></li>
<li><p><code>pitch</code>, <code>roll</code>: Orientation angles (radian)</p></li>
<li><p><code>acceleration_xp</code>, <code>acceleration_yp</code>, <code>acceleration_zp</code>: Gravity projected in NED frame</p></li>
<li><p><code>is_outlier</code>: Logical, marks outliers in magnetic data</p></li>
<li><p><code>magnetic_xc</code>, <code>magnetic_yc</code>, <code>magnetic_zc</code>: Calibrated magnetic data</p></li>
<li><p><code>magnetic_xcp</code>, <code>magnetic_ycp</code>, <code>magnetic_zcp</code>: Calibrated magnetic data projected in NED
frame</p></li>
<li><p><code>H</code>: Heading (radian, North=0)</p></li>
<li><p><code>F</code>: Magnetic field intensity (Gauss)</p></li>
<li><p><code>I</code>: Inclination (radian)
Also returns (invisibly) the calibration dataset used (<code>tag$mag_calib</code>) and calibration
parameters (<code>tag$param$geomag_calib</code>).</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>


<p>This function is part of the <code>GeoMag</code> package and is intended for use with animal-attached tags
that record magnetic and acceleration data. It supports several calibration workflows and robust
outlier detection.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Rafnuss/GeoPressureR" class="external-link">GeoPressureR</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_dir.html" class="external-link">with_dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"GeoMag"</span><span class="op">)</span>, <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/tag_create.html" class="external-link">tag_create</a></span><span class="op">(</span><span class="st">"14DM"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://raphaelnussbaumer.com/GeoPressureR/reference/tag_label.html" class="external-link">tag_label</a></span><span class="op">(</span><span class="va">tag</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu">geomag_calib</span><span class="op">(</span><span class="va">tag</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">tag</span><span class="op">$</span><span class="va">param</span><span class="op">$</span><span class="va">geomag_calib</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tag</span><span class="op">$</span><span class="va">magnetic</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Using raw magnetic data for calibrationd data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  date magnetic_x magnetic_y magnetic_z acceleration_x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2015-07-15 00:00:00    0.30368    0.12848   -0.14048     -1.0158691</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 2015-07-15 04:00:00   -0.02016   -0.26800   -0.37840     -0.4349365</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 2015-07-15 08:00:00   -0.19648    0.05904   -0.42176     -0.3776245</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 2015-07-15 12:00:00    0.09968    0.16864   -0.33072     -0.9479370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 2015-07-15 16:00:00    0.28208   -0.12928   -0.22688     -0.9280396</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 2015-07-15 20:00:00    0.26384   -0.12560   -0.26272     -1.0314331</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   acceleration_y acceleration_z stap_id act is_static magnetic_xc magnetic_yc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0.115905762      0.2175903       1   0      TRUE  0.39674525  0.14658447</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   -0.013183594      1.9647217       1  16     FALSE  0.09063291 -0.25724728</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   -0.115295410      1.1094971       1   5     FALSE -0.07521795  0.07863007</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   -0.112731934      0.7674561       1   6     FALSE  0.20274948  0.18974057</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   -0.008361816      1.0251465       1   4     FALSE  0.37535353 -0.11683502</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   -0.004760742      0.1928101       1   0      TRUE  0.35765925 -0.11271694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   magnetic_zc     pitch         roll acceleration_xp acceleration_yp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  -0.1299802 1.3327149  0.489447620   -1.387779e-16    0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  -0.3812061 0.2178549 -0.006710058    0.000000e+00   -1.734723e-18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  -0.4327244 0.3264234 -0.103545172    0.000000e+00    0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  -0.3330282 0.8849994 -0.145847404    0.000000e+00    0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  -0.2184198 0.7357053 -0.008156523   -1.110223e-16    0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  -0.2562643 1.3859400 -0.024686342   -3.053113e-16    0.000000e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   acceleration_zp magnetic_xcp magnetic_ycp magnetic_zcp          H         F</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1.045356  0.049055307   0.19048308   -0.3963564 -1.3187423 0.4424801</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        2.012331  0.006473343  -0.25979938   -0.3900909  1.5458848 0.4687308</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1.177657 -0.211865235   0.03348242   -0.3912581 -2.9848525 0.4461960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        1.224860 -0.147940672   0.13932683   -0.3830381 -2.3861709 0.4336088</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        1.382842  0.132331817  -0.11861266   -0.4131189  0.7307824 0.4497198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        1.049311 -0.183346905  -0.11900818   -0.3981427  2.5658592 0.4541989</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1.1101402</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.9831143</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 1.0693225</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 1.0830101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 1.1645586</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 1.0687138</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Raphaël Nussbaumer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

